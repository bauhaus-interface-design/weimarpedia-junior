{namespace wpj=Tx_Wpj_ViewHelpers}
<f:layout name="default" />

<f:section name="main">
	<div id="nav-wiki-tools">
		<hr class="hideme" />
	</div>

	<div class="grid">
		<div id="notifications">
			<f:flashMessages />
		</div>
	</div>
	<f:render partial="formErrors" />
	
	<!-- hidden form generated by typo3 -->
	<f:form method="post" action="{f:if(condition: '{article.uid} > 0', then: 'update', else: 'create')}" name="article" id="article_form" object="{article}" style="position: absolute; left: -9999px; top: -9999px;" > 
		<f:form.hidden property="title" />
		<f:form.hidden property="body"/>
		<f:form.hidden property="articletype"/>
		<f:form.hidden property="reviewed"/>
		<f:form.hidden name="mediaContent" value="" id="mediaContent" />
	</f:form> 
	
	<div id="main" role="main" class="grid">
		<h2 class="hideme">Inhalt: Artikel</h2>
		<div class="row">
			<div class="slot-0-1-2-3">
				<article class="article {article.articletypeCssClass}" id="article">
					<!-- aloha editable blocks -->
					<h3 class="alohaEditor" id="article_title">{article.title}</h3>
					<div class="alohaEditor" id="article_body">
						<f:format.html parseFuncTSPath="">{article.body}</f:format.html>
					</div>
					<hr class="hideme" />
					<div class="media">

			    		<f:if condition="{editingAllowed}">
			    			<div style="margin: 1em 0">
							<a class="wpj-button" id="addMediaLink" href="<wpj:actionUrl action='addMedia' arguments='{article:article}' pageType='0'/>">Medien verwalten</a>
							</div>
			    		</f:if>
						<div id="medialist"><f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner"/></div>

					</div>
				</article>
			</div>
			<div class="slot-4-5">

<!-- Article Meta -->
<aside>
	<div class="metabox hide-for-mobile">
		<h4>Bearbeitung</h4>
		<wpj:isGuest>

			<f:then>
				<p><f:link.action class="wpj-button" controller="session" action="loginForm">Artikel bearbeiten</f:link.action></p>
			</f:then>
			
			<f:else>
			<wpj:ifAdminLevel minLevel="1">
				
				<f:then>
					<p id="editThis"><a class="wpj-button" href="#" id="startEditing">Artikel bearbeiten</a></p>
					
					<div id="editOptions" style="display:none;">
						
						<p class="weighty sub" id="articletypeSelector">
							Der Artikel hat folgenden Typ:<br>
							<f:form fieldNamePrefix="_type_" name="article" object="{article}" > 
							<f:form.select id="articletype" property="articletype" options="{articletypes}" optionLabelField="name" optionValueField="uid"/>
							</f:form>
						</p>
						
						<p>
							<a class="wpj-button" href="#" id="butSave">Zwischenspeichern</a>&nbsp;
							<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner" id="saveAjaxSpinner" style="display:none;"/>
						</p>
						<p>
							<a class="wpj-button" href="#" id="butSaveAndExit">Speichern und beenden</a>
						</p>
						<p>
							<a class="wpj-button" href="#" id="butBreak">Abbrechen</a>
						</p>
						<wpj:ifAdminLevel minLevel="10">
							<p><f:link.action class="wpj-button danger" action="delete" controller="articleAdmin" arguments="{article: article}" onclick="return confirm('Den Artikel wirklich loeschen?');">
								Artikel l&ouml;schen
							</f:link.action></p>
						</wpj:ifAdminLevel>
					</div>
					
					<f:if condition="{article.reviewed}>0">
						
						<f:then>
							<div class="mt">
							<p class="sub weighty">Der Artikel ist freigegeben und f&uuml;r alle sichtbar.</p>
							<wpj:ifAdminLevel minLevel="10">
								<p class="sub">Alle &Auml;nderungen verwerfen und die Freigabe des Artikels zur&uuml;ckziehen.</p>		
								<p><f:link.action class="wpj-button danger" action="setReview" arguments="{reviewed:0,article: article}">Freigabe stoppen</f:link.action></p>	
							</wpj:ifAdminLevel>
							</div>
						</f:then>
						
						<f:else>
							<wpj:ifAdminLevel minLevel="10">
								<div class="mt">
									<p class="sub weighty">Bitte pr&uuml;fen Sie:</p>
									<ul class="checklist">
										<li>Text auf inhaltliche Richtigkeit</li>
										<li>alle Medien inkl. Nutzungsrechte </li>
									</ul>
								</div>
								<div class="mt">
								<p class="sub weighty">Der Artikel ist <strong>nicht</strong> freigegeben.</p>
								<p class="sub">Alle &Auml;nderungen verwerfen und den Artikel mit allen Medien freigeben</p>		
								<p><f:link.action class="wpj-button danger" action="setReview" arguments="{reviewed:1,article: article}">Artikel freigeben</f:link.action></p>
								</div>
							</wpj:ifAdminLevel>
						</f:else>
						
					</f:if>
				</f:then>
				
			</wpj:ifAdminLevel>
			</f:else>
		</wpj:isGuest>
	</div>


	<div class="metabox">
		<h4>Einsortieren</h4> 
			
			<h5>Schlagwörter:</h5>
	    	<ul id="tagList" class="tags clearfix removable-items">
	    		<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner"/>
	    	</ul>
			<wpj:ifAdminLevel minLevel="1">
				<ul id="tagField"></ul>
				<p><a id="saveTags" class="wpj-button" href="#">Neue Schlagwörter zuweisen</a></p>
			</wpj:ifAdminLevel>	
			
			<h5 class="mt">Orte:</h5>
	    	<ul id="placeList" class="tags clearfix removable-items">
	    		<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner"/>
	    	</ul>
	    	<ul id="placeTempList"></ul>
	    	
			<wpj:ifAdminLevel minLevel="1">
				<p><a class="wpj-button" id="openPlaceWindow" href="<wpj:actionUrl action='placeSelectForm' arguments='{article:article}' pageType='10'/>">Ort auswählen</a></p>
			</wpj:ifAdminLevel>	
			
			<wpj:ifAdminLevel minLevel="10">
				<h5 class="mt">Ortsreferenz:</h5>
				<ul id="refplaceList" class="tags clearfix removable-items">
		    		<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner"/>
		    	</ul>
		    	<p><a class="wpj-button" id="openRefPlaceWindow" href="<wpj:actionUrl action='placeSelectForm' arguments='{article:article}' pageType='10'/>">Ortsreferenz auswählen</a></p>
			</wpj:ifAdminLevel>		
	</div>
	
	

	
	<div class="metabox">
		<h4>Autoren</h4>
			<div id="authorslist">
				<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..."/>
			</div>
	</div>
	
<wpj:ifAdminLevel minLevel="20">
	<div class="metabox">
		<h4>Versionen</h4>
		<p><a id="loadVersionsBtn">Liste der Versionen laden</a></p>
		<div id="versionslist" class="tags clearfix">
			<f:image src="typo3conf/ext/wpj/Resources/Public/img/spinner.gif" alt="warten..." class="spinner"/>
		</div>

		<p class="sub">Der Artikel wurde zuletzt am 
		<f:format.date format="d.m.Y \u\m H:i">{article.updatedAt}</f:format.date>
		 ge&auml;ndert und am 
		 <f:format.date format="d.m.Y \u\m H:i">{article.createdAt}</f:format.date> erstellt.
		</p> 
	</div>
</wpj:ifAdminLevel>					

</aside>
<!-- //Article Meta -->

			</div>
		</div>
	</div>
	
<!-- autocomplete -->
<script type="text/javascript" src="typo3conf/ext/wpj/Resources/Public/js/jquery-ui-1.8.14.custom.min.js"></script>
<script type="text/javascript" src="typo3conf/ext/wpj/Resources/Public/js/tagging.js"></script>
<script type="text/javascript" src="typo3conf/ext/wpj/Resources/Public/js/article.js"></script>

<script type="text/javascript">
	<!--
	
	//var myLogger = console.log;
	
	var suggestArticleUrl = '<wpj:actionUrl action="suggestArticle" pageType="10"/>&term=';
	var suggestTagUrl = 	'<wpj:actionUrl action="suggestTag" pageType="10"/>';
	var suggestTagPlaceUrl ='<wpj:actionUrl action="suggestTagPlace" pageType="10"/>';
	var loadChildrenUrl ='<wpj:actionUrl action="loadPlaceChildren" pageType="10"/>';
	
	var loadTagBoxUrl = 	'<wpj:actionUrl action="loadTagBox" arguments="{article:article}" pageType="10"/>';
    var addTagUrl = 		'<wpj:actionUrl action="addTag" arguments="{article:article}" pageType="10"/>';
    var removeTagUrl = 		'<wpj:actionUrl action="removeTag" arguments="{article:article}" pageType="10"/>';
    var loadMediaBoxUrl = 	'<wpj:actionUrl action="loadMediaBox" arguments="{article:article}" pageType="10"/>';
    var loadMapBoxUrl = 	'<wpj:actionUrl action="loadMapBox" arguments="{article:article}" pageType="10"/>';
    var loadAuthorsBoxUrl =	'<wpj:actionUrl action="loadAuthorsBox" arguments="{article:article}" pageType="10"/>';
    var loadVersionsBoxUrl ='<wpj:actionUrl action="loadVersionsBox" arguments="{article:article}" pageType="10"/>';
    
    var loadMapXmlUrl = 	'<wpj:actionUrl action="loadMapXml" arguments="{article:article}" pageType="20"/>';
    
           
	// -->
</script>
<f:format.html parseFuncTSPath="">{additionalFooterData}</f:format.html>


</f:section>